{\rtf1\ansi\ansicpg1252\uc1 \deff0\deflang1036\deflangfe1036{\fonttbl{\f0\froman\fcharset0\fprq2{\*\panose 02020603050405020304}Times New Roman;}{\f2\fmodern\fcharset0\fprq1{\*\panose 02070309020205020404}Courier New;}
{\f23\fmodern\fcharset128\fprq1{\*\panose 02020609040205080304}MS Mincho{\*\falt ?? ??};}{\f28\fmodern\fcharset128\fprq1{\*\panose 00000000000000000000}@MS Mincho;}{\f177\froman\fcharset238\fprq2 Times New Roman CE;}
{\f178\froman\fcharset204\fprq2 Times New Roman Cyr;}{\f180\froman\fcharset161\fprq2 Times New Roman Greek;}{\f181\froman\fcharset162\fprq2 Times New Roman Tur;}{\f182\froman\fcharset177\fprq2 Times New Roman (Hebrew);}
{\f183\froman\fcharset178\fprq2 Times New Roman (Arabic);}{\f184\froman\fcharset186\fprq2 Times New Roman Baltic;}{\f193\fmodern\fcharset238\fprq1 Courier New CE;}{\f194\fmodern\fcharset204\fprq1 Courier New Cyr;}
{\f196\fmodern\fcharset161\fprq1 Courier New Greek;}{\f197\fmodern\fcharset162\fprq1 Courier New Tur;}{\f198\fmodern\fcharset177\fprq1 Courier New (Hebrew);}{\f199\fmodern\fcharset178\fprq1 Courier New (Arabic);}
{\f200\fmodern\fcharset186\fprq1 Courier New Baltic;}{\f363\fmodern\fcharset0\fprq1 MS Mincho Western{\*\falt ?? ??};}{\f361\fmodern\fcharset238\fprq1 MS Mincho CE{\*\falt ?? ??};}{\f362\fmodern\fcharset204\fprq1 MS Mincho Cyr{\*\falt ?? ??};}
{\f364\fmodern\fcharset161\fprq1 MS Mincho Greek{\*\falt ?? ??};}{\f365\fmodern\fcharset162\fprq1 MS Mincho Tur{\*\falt ?? ??};}{\f368\fmodern\fcharset186\fprq1 MS Mincho Baltic{\*\falt ?? ??};}}{\colortbl;\red0\green0\blue0;\red0\green0\blue255;
\red0\green255\blue255;\red0\green255\blue0;\red255\green0\blue255;\red255\green0\blue0;\red255\green255\blue0;\red255\green255\blue255;\red0\green0\blue128;\red0\green128\blue128;\red0\green128\blue0;\red128\green0\blue128;\red128\green0\blue0;
\red128\green128\blue0;\red128\green128\blue128;\red192\green192\blue192;}{\stylesheet{\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0 \fs24\lang1036\langfe1036\cgrid\langnp1036\langfenp1036 \snext0 Normal;}{\*\cs10 \additive 
Default Paragraph Font;}{\s15\ql \li0\ri0\nowidctlpar\faauto\rin0\lin0\itap0 \fs24\lang1036\langfe1036\cgrid\langnp1036\langfenp1036 \snext15 Standard;}{\*\cs16 \additive \ul\cf9 Internet link;}{
\s17\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0 \f2\fs20\lang1036\langfe1036\cgrid\langnp1036\langfenp1036 \sbasedon0 \snext17 Plain Text;}}{\info{\title (((rubrique: Pratique)))}{\author Romain Guy}{\operator Gimli}
{\creatim\yr2000\mo10\dy13\hr19\min31}{\revtim\yr2000\mo10\dy16\min50}{\printim\yr2000\mo10\dy15\hr23\min11}{\version28}{\edmins477}{\nofpages3}{\nofwords1417}{\nofchars7816}{\*\company The Dwarf Company}{\nofcharsws0}{\vern8249}}
\paperw11905\paperh16837\margl1134\margr1134\margt1134\margb1134 \deftab709\widowctrl\ftnbj\aenddoc\hyphhotz425\makebackup\noxlattoyen\expshrtn\noultrlspc\dntblnsbdb\nospaceforul\hyphcaps0\horzdoc\dghspace120\dgvspace120\dghorigin1701\dgvorigin1984
\dghshow0\dgvshow3\jcompress\viewkind1\viewscale90\viewzk2\nolnhtadjtbl \fet0\sectd \sbknone\linex0\sectdefaultcl {\*\pnseclvl1\pnucrm\pnstart1\pnindent720\pnhang{\pntxta .}}{\*\pnseclvl2\pnucltr\pnstart1\pnindent720\pnhang{\pntxta .}}{\*\pnseclvl3
\pndec\pnstart1\pnindent720\pnhang{\pntxta .}}{\*\pnseclvl4\pnlcltr\pnstart1\pnindent720\pnhang{\pntxta )}}{\*\pnseclvl5\pndec\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}{\*\pnseclvl6\pnlcltr\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}
{\*\pnseclvl7\pnlcrm\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}{\*\pnseclvl8\pnlcltr\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}{\*\pnseclvl9\pnlcrm\pnstart1\pnindent720\pnhang{\pntxtb (}{\pntxta )}}\pard\plain 
\s15\ql \li0\ri0\nowidctlpar\faauto\rin0\lin0\itap0 \fs24\lang1036\langfe1036\cgrid\langnp1036\langfenp1036 {\f2\fs20 (((Article pour PC Team 63, d\'e9cembre 2000)))
\par (((Rubrique: Team pratik)))
\par (((Sous Rubrique: \'e9lectronique)))
\par 
\par (((titre)))
\par Le port parall\'e8le
\par 
\par (((chapo)))
\par Nous commen\'e7ons ce mois-ci une s\'e9rie d'articles consacr\'e9s aux ports du PC. Avant d'attaquer quelques montages pratiques, voyons comment mettre en \'9cuvre ce bon vieux port parall\'e8le encore bien utile.
\par 
\par (((texte)))
\par Le port parall\'e8le est bas\'e9 sur une architecture assez ancienne mais tr\'e8s simple \'e0 utiliser, ce qui en fait l'interface de pr\'e9dilection de tout \'e9lectronicien amateur. Comme son nom l'indique, il fournit, entres autres, 8 broches de donn
\'e9es directement utilisables et ne n\'e9cessitant pas de circuits d'interfaces suppl\'e9mentaires pour r\'e9aliser des taches simples. De plus, comme nous le verrons plus loin, la programmation de ce port est tr\'e8s ais\'e9e et ce, \'e0
 partir de nombreux langages.
\par 
\par (((Sous-titre: Brochage et performances)))
\par 
\par (((texte)))
\par Le port parall\'e8le se pr\'e9sente sous la forme d'un connecteur DB femelle \'e0 25 broches. Seules 17 broches sont utilisables, les 8 broches restantes sont interconnect\'e9es \'e0 la masse du PC. Le sch\'e9ma ci contre montre le brochage de ce port.

\par 
\par }\pard\plain \s17\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0 \f2\fs20\lang1036\langfe1036\cgrid\langnp1036\langfenp1036 {\dbch\af23 \hich\af2\dbch\af23\loch\f2 (((image PCTeam63_1.tif)))
\par }\pard\plain \s15\ql \li0\ri0\nowidctlpar\faauto\rin0\lin0\itap0 \fs24\lang1036\langfe1036\cgrid\langnp1036\langfenp1036 {\f2\fs20 
\par (((texte)))
\par }\pard\plain \ql \li0\ri0\widctlpar\faauto\rin0\lin0\itap0 \fs24\lang1036\langfe1036\cgrid\langnp1036\langfenp1036 {\f2\fs20 Nous remarquons que le nom de certaines broches nous est assez familier ; en fait ce port a \'e9t\'e9 con\'e7u \'e0
 l'origine pour y brancher des imprimantes. Le d\'e9bit fourni par ce port est de l'ordre de 150ko/s, ce qui limite fortement les possibilit\'e9s d'y connecter d'autres p\'e9riph\'e9riques. C'est pourquoi les grands noms de l'informatique ont cr\'e9\'e9
 5 standards regroup\'e9s dans la norme IEEE 1284 (dans l'ordre croissant de performance) : }{\i\f2\fs20 Compatibility Mode, Nibble Mode, Byte Mode, EPP Mode (Enhanced Parallel Port) }{\f2\fs20 et}{\i\f2\fs20  ECP Mode (Extended Capabilities Port)}{
\f2\fs20 . Ces standards ont une compatibilit\'e9 descendante et les PC actuels sont capables de travailler dans n'importe lequel de ces modes, sous r\'e9serve que le port a \'e9t\'e9 configur\'e9 convenablement (voir l'encadr\'e9
). Dans sa version la plus simple (}{\i\f2\fs20 Compatibility Mode)}{\f2\fs20 , les donn\'e9es ne peuvent servir qu'en sortie. Il existe cependant une m\'e9thode pour acc\'e9der \'e0 une lecture de donn\'e9es en utilisant d'autres broches du port et proc
\'e9d\'e9 \'e9lectronique appel\'e9 multiplexage. Ce que nous retiendrons est que les modes les plus r\'e9cents (EPP et ECP) rendent possible la lecture par l'interm\'e9diaire du bus de donn\'e9es. Le d\'e9bit a \'e9t\'e9 ainsi augment\'e9 \'e0
 2 Mo/s, ce qui a permis de connecter sur le port parall\'e8le des p\'e9riph\'e9riques plus rapides tels que scanners, lecteurs cd CD-ROM etc.
\par Au point de vue des performances \'e9lectriques, chaque broche du port est capable de fournir un courant maximal de 12 mA environ. Il faut donc faire attention \'e0 la charge que l'on applique et de placer les r\'e9sistances ad\'e9
quates. Une solution pour \'e9viter tout probl\'e8me de consommation est de placer un buffer juste \'e0 la sortie du port. Les niveaux de tension sont compatibles TTL : cela signifie qu'un bit mis \'e0 1 provoquera une mise \'e0
 +5V sur la broche correspondante, et un 0 logique mettra la broche \'e0 0V (la masse du PC).
\par }\pard\plain \s15\ql \li0\ri0\nowidctlpar\faauto\rin0\lin0\itap0 \fs24\lang1036\langfe1036\cgrid\langnp1036\langfenp1036 {\f2\fs20 Pour la lecture de donn\'e9es, il faut faire un peu plus attention car cela d\'e9pend de la technologie utilis\'e9
e. En effet, certains ports poss\'e8dent une r\'e9sistance interne dite de "pull-up" (tirage au +5V) sur leurs broches tandis que d'autres ont leurs sorties dites en "collecteur ouvert". Pour tester dans quel cas se situe de port parall\'e8le d'un PC, 
on peut se servir du programme Input.exe fournit sur le CD Pro. Si le r\'e9sultat est 255 cela signifie que les broches du bus de donn\'e9es poss\'e8dent une r\'e9sistance de tirage. Le sch\'e9ma ci contre montre comment r\'e9
aliser une interface qui sera compatible avec toutes les technologies. Il est pr\'e9f\'e9rable de prendre une r\'e9sistance de l'ordre de 4,7 KOhm de fa\'e7on a rester au maximum compatible. 
\par }\pard\plain \s17\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0 \f2\fs20\lang1036\langfe1036\cgrid\langnp1036\langfenp1036 {\dbch\af23 \hich\af2\dbch\af23\loch\f2 (((image PCTeam63_2.tif)))
\par }\pard\plain \s15\ql \li0\ri0\nowidctlpar\faauto\rin0\lin0\itap0 \fs24\lang1036\langfe1036\cgrid\langnp1036\langfenp1036 {\f2\fs20 
\par (((Sous-titre: Les registres)))
\par 
\par (((texte)))
\par Toute la gestion du port parall\'e8le se r\'e9alise par l'interm\'e9diaire de trois registres de 8 bits. Le premier correspond \'e0 l'adresse de base du port : c'est le registre de donn\'e9es (0x378 par exemple). Les lignes D0 \'e0
 D7 de la prise prennent le niveau correspondant \'e0 la donn\'e9e inscrite dans ce registre et si la fonction bidirectionnelle a \'e9t\'e9 configur\'e9e on peut y lire l'\'e9tat des broches. L'octet suivant (0x379) est le registre d'\'c9
tat accessible en lecture uniquement. Enfin, on trouve le registre de Contr\'f4le (0x37A) accessible en lecture et en \'e9criture. Une attention particuli\'e8re doit \'eatre port\'e9e sur le bit 5 (BID CTRL) qui permet, lorsqu'il est \'e0
 1, de configurer le bus de donn\'e9es en lecture. Le tableau ci-dessous nous permettra de configurer facilement ces registres.
\par 
\par }{\fs20\loch\af2\hich\af2\dbch\af23 \hich\af2\dbch\af23\loch\f2 (((image PCTeam63_3.tif)))}{\f2\fs20 
\par 
\par (((Sous-titre: Programmation du port)))
\par 
\par (((texte)))
\par Le port parall\'e8le est extr\'eamement simple \'e0 programmer. Plusieurs langages poss\'e8dent les fonctions pour acc\'e9der au contr\'f4le des registres. Ainsi, il est possible de programmer en Basic \'e0 l'aide de INP et OUT ou dans des langages plus 
\'e9volu\'e9s comme le C. Nous nous int\'e9resserons plus particuli\'e8rement \'e0 ce dernier langage mais \'e9galement au Visual Basic qui nous permettra d'avoir une interface logicielle plus agr\'e9able.
\par Dans le cas du C, il existe deux fonctions pour \'e9crire et lire dans un registre. Elles sont accessibles dans les biblioth\'e8ques standards, \'e0 savoir dos.h, bios.h ou pc.h suivant les compilateurs. Les prototypes des fonctions sont les suivantes :

\par 
\par (((listing)))
\par void outportb(unsigned short ADRESSE, unsigned char  VALEUR);
\par unsigned char inportb(unsigned short ADRESSE);
\par (((fin listing)))
\par 
\par (((texte)))
\par R\'e9alisons sans plus attendre notre premi\'e8re application. Un moyen tr\'e8s pratique pour comprendre et v\'e9rifier le fonctionnement du port parall\'e8le est de r\'e9aliser le sch\'e9ma pr\'e9sent\'e9 ci apr\'e8s. Connect\'e9 sur le bus de donn\'e9
es, on peut visualiser directement le contenu du registre gr\'e2ce aux LED. Les r\'e9sistances servent \'e0 limiter le courant traversant les diodes. D\'e8s lors, il suffit d'une simple ligne en C pour allumer les LED d\'e9sir\'e9es. Il est possible \'e9
galement d'utiliser le programme Output.exe contenu sur le CD qui permet d'\'e9crire une donn\'e9e sur le port parall\'e8le.
\par 
\par (((listing)))
\par #include <pc.h>
\par 
\par void main(void)
\par \{
\par \tab unsigned char Valeur;
\par }\pard \s15\ql \fi709\li0\ri0\nowidctlpar\faauto\rin0\lin0\itap0 {\f2\fs20 outportb(0x378,0xFF); /* On allume toutes les LED */
\par Valeur = inportb(0x378); /* On lit le registre de donn\'e9es
\par }\pard \s15\ql \li0\ri0\nowidctlpar\faauto\rin0\lin0\itap0 {\f2\fs20 \}
\par (((fin listing)))
\par 
\par }{\fs20\loch\af2\hich\af2\dbch\af23 \hich\af2\dbch\af23\loch\f2 (((image PCTeam63_4.tif)))}{\f2\fs20 
\par 
\par (((texte)))
\par Une remarque peut \'eatre apport\'e9e au listing pr\'e9c\'e9dent. En effet, nous n'avons pas configur\'e9 le bus de donn\'e9es en entr\'e9e, donc ce que nous lisons est juste la valeur du registre, soit Valeur=255 ici. Le registre de donn\'e9
es ne devient l'image des broches que si le bit 5 du registre de contr\'f4le est \'e0 1.
\par Le cas de Visual Basic est un peu plus d\'e9licat. En effet, aucune fonction n'existe en standard. Pour cela, nous avons recours aux c\'e9l\'e8bres DLL qui permettent d'\'e9tendre les possibilit\'e9
s du langage. Nous allons utiliser Inpout.dll (comprendre Inp-out, en rapport avec les fonctions du m\'eame nom en Basic) qui contient deux fonctions permettant de lire et d'\'e9
crire dans un des trois registres. Les prototypes des fonctions sont les suivantes :
\par 
\par (((listing)))
\par Out ADRESSE, VALEUR
\par VALEUR = Inp(ADRESSE)
\par (((fin listing)))
\par 
\par (((texte)))
\par Tout projet n\'e9cessitant l'utilisation de cette DLL doit contenir un module servant \'e0 d\'e9clarer ces nouvelles fonctions que Visual Basic ne conna\'eet pas. Il faut aller dans le menu "Projet" puis cliquer sur "Ajouter un module". Inscrire alors
 dans ce module le code suivant :
\par 
\par (((listing)))
\par Public Declare Function Inp Lib "inpout32.dll" _
\par Alias "Inp32" (ByVal PortAddress As Integer) As Integer
\par Public Declare Sub Out Lib "inpout32.dll" _
\par Alias "Out32" (ByVal PortAddress As Integer, ByVal Value As Integer)
\par (((fin listing)))
\par 
\par (((texte)))
\par Et voil\'e0 ce n'est pas plus difficile que \'e7a. Ceux n'ayant pas Visual Basic peuvent utiliser le programme TestParall\'e8le.exe situ\'e9 sur le CD Pro. Il est capable d'\'e9
crire dans tous les registres et montre en permanence leur valeur. Tous les programmes sont accompagn\'e9s de leurs sources avec des commentaires. Il n'y a aucune difficult\'e9 de programmation. Cette introduction un peu th\'e9orique au port parall\'e8
le nous a donn\'e9 les bases pour d\'e9velopper des applications plus compl\'e8tes, ce que nous verrons durant les prochains mois. 
\par 
\par (((signature)))
\par Anthony Rabine
\par arabine@programmationworld.com
\par 
\par (((illustrations)))
\par PCTeam63_1.tif (((l\'e9gende: Le brochage du port parall\'e8le)))
\par PCTeam63_2.tif (((l\'e9gende: Une interface d'entr\'e9e id\'e9ale)))
\par PCTeam63_3.tif (((l\'e9gende: Les trois registres de configuration)))
\par PCTeam63_4.tif (((l\'e9gende: Un montage simple pour visualiser les donn\'e9es)))
\par PCTeam63_5.tif (((l\'e9gende: Notre programme Visual Basic pour tester le port)))
\par 
\par 
\par }\pard\plain \s17\ql \li0\ri0\widctlpar\aspalpha\aspnum\faauto\adjustright\rin0\lin0\itap0 \f2\fs20\lang1036\langfe1036\cgrid\langnp1036\langfenp1036 {\dbch\af23 \hich\af2\dbch\af23\loch\f2 \hich\f2 (((encadr\'e9\loch\f2 )))
\par \hich\af2\dbch\af23\loch\f2 \hich\f2 (((titre encadr\'e9\loch\f2 )))
\par \hich\af2\dbch\af23\loch\f2 \hich\f2 Configurer le port parall\'e8\loch\f2 le
\par \hich\af2\dbch\af23\loch\f2 \hich\f2 (((texte encadr\'e9\loch\f2 )))
\par \hich\af2\dbch\af23\loch\f2 Tout d'abord, il\hich\af2\dbch\af23\loch\f2  \hich\af2\dbch\af23\loch\f2 \hich\f2 faut conna\'ee\loch\f2 \hich\f2 tre l'adresse de base du port parall\'e8\loch\f2 \hich\f2 le. Cela peut se faire tr\'e8\loch\f2 \hich\f2 
s facilement sous Windows par l'interm\'e9\loch\f2 \hich\f2 diaire du panneau "Propri\'e9\loch\f2 \hich\f2 t\'e9\loch\f2 \hich\f2 s syst\'e8\loch\f2 me" et dans l'onglet "Gestion\hich\af2\dbch\af23\loch\f2 \hich\f2 naire de p\'e9\loch\f2 \hich\f2 riph\'e9
\loch\f2 riques". Cliquer\hich\af2\dbch\af23\loch\f2  sur "Ports", "Port imprimante (LTP1)", "\hich\af2\dbch\af23\loch\f2 \hich\f2 Propri\'e9\loch\f2 \hich\f2 t\'e9\loch\f2 \hich\f2 s" puis "Ressources". La grande majorit\'e9\loch\f2 \hich\f2 
 des ordinateurs ont une adresse de 0x378 (en hexad\'e9\loch\f2 \hich\f2 cimal). Cette adresse est appel\'e9\loch\f2 \hich\f2 e adresse de base, et correspond au registre de donn\'e9\loch\f2 \hich\f2 es. Le mode de fonctionnement du port se modifie quant 
\'e0\loch\f2  lui dans le \hich\af2\dbch\af23\loch\f2 B\hich\af2\dbch\af23\loch\f2 IOS \hich\af2\dbch\af23\loch\f2 ;\hich\af2\dbch\af23\loch\f2 \hich\f2  red\'e9\loch\f2 marrer\hich\af2\dbch\af23\loch\f2  l'ordinateur, alle\hich\af2\dbch\af23\loch\f2 r
\hich\af2\dbch\af23\loch\f2  dans la sectio\hich\af2\dbch\af23\loch\f2 n "Peripherial Setup" et changer\hich\af2\dbch\af23\loch\f2  l'option "Paral\hich\af2\dbch\af23\loch\f2 lel Port Mode" selon la configuration\hich\af2\dbch\af23\loch\f2 \hich\f2  d\'e9
\loch\f2 sir\loch\af2\dbch\af23\hich\f2 \'e9\loch\f2 e\hich\af2\dbch\af23\loch\f2 . 
\par }{
\par }}